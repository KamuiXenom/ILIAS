<li class="ilAwarenessDropDown"><a data-toggle="popover" id="awareness_trigger"><span class="glyphicon glyphicon-user"></span> <!-- BEGIN status_text --><span class="badge">{STATUS_TXT}</span><span class="ilBadgeSpacer">{STATUS_TXT}</span><!-- END status_text --></a></li>
<script>
	$('#awareness_trigger').popover({
		html : true,
		placement : "bottom",
		viewport : { selector: 'body', padding: 10 },
		title: " "
	});

	$('#awareness_trigger').on('show.bs.popover', function () {
		//$("#awareness-content").html();
//		console.log(this);

	}).on('shown.bs.popover', function () {
		$('#awareness_trigger').siblings(".popover").children(".popover-content").html(il.Awareness.getContent());

		$("body").addClass("modal-open");

		il.Awareness.afterListUpdate();

	}).on('hidden.bs.popover', function () {
		$("body").removeClass("modal-open");
	})

	il.Awareness = {

		rendered: false,
		base_url: "",
		$body:  $(document.body),
		loader_src: "",


		setBaseUrl: function(url) {
			var t = il.Awareness;
			t.base_url = url;
		},

		getBaseUrl: function() {
			var t = il.Awareness;
			return t.base_url;
		},

		setLoaderSrc: function(loader) {
			var t = il.Awareness;
			t.loader_src = loader;
		},

		getLoaderSrc: function() {
			var t = il.Awareness;
			return t.loader_src;
		},

		checkScrollbar: function () {
			if (document.body.clientWidth >= window.innerWidth) return
			this.scrollbarWidth = this.scrollbarWidth || this.measureScrollbar()
		},

		setScrollbar: function () {
			var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
			if (this.scrollbarWidth) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
		},

		resetScrollbar: function () {
			this.$body.css('padding-right', '')
		},

		measureScrollbar: function () { // thx walsh
			var scrollDiv = document.createElement('div')
			scrollDiv.className = 'modal-scrollbar-measure'
			this.$body.append(scrollDiv)
			var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
			this.$body[0].removeChild(scrollDiv)
			return scrollbarWidth
		},

		getContent: function () {
			var t = il.Awareness;

			if (!t.rendered) {
				t.content = $("#awareness-content-container").html();
				$("#awareness-content-container").html("");
				t.updateList("");
				t.rendered = true;
			}
			return t.content;
		},

		ajaxReplaceSuccess: function(o) {
			var t = il.Awareness;

			// perform page modification
			if(o.responseText !== undefined)
			{
				t.content = o.responseText;
				$('#awareness-content').replaceWith(t.content);
				t.afterListUpdate();
			}
		},

		afterListUpdate: function() {
			var t = il.Awareness;

			t.fixHeight();

			$('.ilAwarenessItem').on('shown.bs.dropdown', function () {
				t.fixHeight();
			}).on('hidden.bs.dropdown', function () {
				// if done, height is corrected, but dd is not opened if clicked (when other dd has been opened before)
//				t.fixHeight();
			});

			$("#il_awrn_filter_form").submit(function (e) {
				var t = il.Awareness;
				$("#il_awrn_filer_btn").html("<img src='" + t.loader_src + "' />");
				t.updateList($("#il_awareness_filter").val());
				e.preventDefault();
			});
			$("#il_awareness_filter").each(function() {
				t = this;
				t.focus();
				if (t.setSelectionRange) {
					var len = $(t).val().length * 2;
					t.setSelectionRange(len, len);
				}
			});
		},

		fixHeight: function() {

			$('.ilAwarenessDropDown .popover').css('height', "");
			var st = $('#awareness-list').scrollTop();
			$('#awareness-list').css('height', "");

			var vp_reg = il.Util.getViewportRegion();
			var awpop = il.Util.getRegion('.ilAwarenessDropDown .popover');
			var awlist = il.Util.getRegion('#awareness-list');
			var pad_bot = 15;
			if ((awpop.top - vp_reg.top + awpop.height + pad_bot) > vp_reg.height) {
				var popHeight = vp_reg.height - (awpop.top - vp_reg.top) - pad_bot;
				$('.ilAwarenessDropDown .popover').css('height', popHeight + "px");

				var listHeight = vp_reg.height - (awlist.top - vp_reg.top) - pad_bot;
				$('#awareness-list').css('height', listHeight + "px");

				$('#awareness-list').scrollTop(st);
			}
		},

		updateList: function(filter) {
			var t = il.Awareness;

			il.Util.sendAjaxGetRequestToUrl (t.getBaseUrl() + "&cmd=getAwarenessList"
					+ "&filter=" + encodeURIComponent(filter),
					{}, {}, t.ajaxReplaceSuccess);
		}
	}


	//class="modal-open"

	$('body').on('click', function (e) {
		$('[data-toggle="popover"]').each(function () {
			//the 'is' for buttons that trigger popups
			//the 'has' for icons within a button that triggers a popup
			if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
				$(this).popover('hide');
			}
		});
	});
</script>
<style>
	.ilAwarenessDropDown .popover {
		max-width: 300px;
		color:#000000;
		min-width: 250px;
	}

	#awareness-list {
		overflow: auto;
	}

	.ilAwarenessDropDown .popover-content {
		padding: 0;
	}

	.ilAwarenessDropDown .media-body, .ilAwarenessDropDown .media-left, .ilAwarenessDropDown .media-right {
		display: table-cell;
		vertical-align: top;
	}
	.ilAwarenessDropDown .media-left {
		padding-right: 10px;
	}
	.ilAwarenessDropDown .media {
		padding: 10px;
	}

	#awareness-content .media:hover {
		background-color: #ffeeaa;
	}

	#awareness-content .dropdown-menu {
		position: static;
		float: none;
		-webkit-box-shadow: none;
		-moz-box-shadow: none;
		box-shadow: none;
	}

	#awareness-content .media {
		padding: 0;
	}

	#awareness-content .media-left img {
		width: 45px;
		height: 45px;
	}

	.ilAwarenessItem {
		border-bottom: 1px solid #E9E9E9;
	}

	#awareness-content .media-body {
		white-space: nowrap;
	}

	#awareness-content .media-body {
		padding-top: 8px;
	}

	#awareness-content .media-body h4, #awareness-content .media-body p {
		color: #A0A0A0;
		font-size: 12px;
		padding: 5px 3px 0 3px;
		line-height: 1em;
		margin: 0;
	}

	#awareness-content .media-body h4 {
		padding-top: 0px;
		color: #606060;
	}

	#awareness-content .dropdown-menu {
		background-color: #f0f0f0;
		padding: 10px 0;
		font-size: 12px;
	}

	#awareness-content .dropdown-menu a {
		color: #606060;
	}

	#awareness-content .dropdown-menu a:hover {
		color: #202020;
	}

	#awareness-content .arrow-down {
		width: 0;
		height: 0;
		border-left: 11px solid transparent;
		border-right: 11px solid transparent;
		border-top: 11px solid #fff;
		margin-top: -10px;
		margin-left: 100px;
	}

	.ilAwarenessDropDown h3.popover-title {
		display:none;
	}

	.ilAwarenessDropDown .media-body {
		/* background-image: url('./templates/default/images/scorm/not_attempted.svg'); */
		background-repeat: no-repeat;
		background-size: 12px 12px;
		width: 100%;
		background-position: right 10px top 50%;
	}

	.ilAwarenessDropDown .media-body.ilAwarenessOnline {
		background-image: url('./templates/default/images/scorm/completed.svg');
	}

	.ilAwarenessLoader {
		display: block;
		margin: 15px auto;
		width: 30px;
		height: 30px;
	}

	#il_awrn_filer_btn {
		width: 30px;
	}

	#il_awrn_filer_btn img {
		width: 10px;
		height: 10px;
	}

</style>
<div id="awareness-head" class="hide">
</div>
<div id="awareness-content-container" class="hide">
	<div id="awareness-content">
	<img class="ilAwarenessLoader" src="{LOADER}" />
	</div>
</div>